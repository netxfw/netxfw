# netxfw 测试策略与用例说明

## 测试概述

netxfw 采用多层次测试策略，包括单元测试、集成测试和性能测试，确保系统在各种场景下的稳定性和性能。

## 测试分类

### 1. 功能测试

#### 1.1 攻击模拟测试
- **文件**: `test/verify_attack.py`
- **功能**: 模拟高速攻击流量，验证系统在高压下的表现
- **测试内容**:
  - 每秒数千数据包的处理能力
  - 防火墙规则的有效性
  - 系统资源使用情况

#### 1.2 混合审批流程测试
- **文件**: `test/verify_hybrid_approval.go`
- **功能**: 测试手动和自动规则添加的工作流程
- **测试场景**:
  - 手动添加规则并立即激活
  - 外部告警自动激活规则
  - 手动添加规则并保持待审批状态

### 2. 集成测试

#### 2.1 插件系统测试
- 验证插件加载、卸载功能
- 测试插件与主系统的交互
- 验证插件间的兼容性

#### 2.2 集群功能测试
- 验证多节点规则同步
- 测试故障转移机制
- 验证负载均衡策略

### 3. 性能测试

#### 3.1 吞吐量测试
- 验证系统在高流量下的处理能力
- 测试不同包大小的处理效率
- 验证并发连接处理能力

#### 3.2 延迟测试
- 测量数据包处理延迟
- 验证系统响应时间
- 测试规则更新的实时性

## 测试执行

### 运行功能测试
```bash
# 运行攻击模拟测试
sudo python3 test/verify_attack.py

# 运行混合审批流程测试
go run test/verify_hybrid_approval.go
```

### 运行单元测试
```bash
# 运行Go单元测试
go test ./...
```

### 运行集成测试
```bash
# 启动netxfw守护进程
sudo ./netxfw daemon

# 运行集成测试脚本
# (具体的集成测试脚本位置)
```

## 测试环境要求

- 网络接口: 至少一个活动的网络接口用于测试
- 权限: 大多数测试需要root权限运行
- 内核版本: 支持eBPF/XDP的Linux内核 (推荐 4.18+)
- 硬件: 推荐多核CPU以测试并发性能

## 测试报告

测试结果应记录以下信息:
- 通过/失败状态
- 执行时间
- 资源使用情况 (CPU, 内存)
- 性能指标 (TPS, 延迟)
- 错误日志

## 持续集成

所有测试应在以下环境下运行:
- GitHub Actions CI
- 代码提交前本地验证
- 发布前完整回归测试