=== RUN   TestAliasFunctions
Compiling Rule alias_test: Msg("Failed") && Msg("root") && Time(60) > 1
2026/02/11 15:06:51 ✅ Rule 'alias_test' loaded: Action=0 (0=Log,1=Dyn,2=Sta), TTL=0s, Path=
Compiling Rule log_func_test: Log("error") && !LogE("DEBUG")
2026/02/11 15:06:51 ✅ Rule 'log_func_test' loaded: Action=0 (0=Log,1=Dyn,2=Sta), TTL=0s, Path=
Compiling Rule lowercase_time_test: Msg("failed") && Msg("root") && Time(60) > 1
2026/02/11 15:06:51 ✅ Rule 'lowercase_time_test' loaded: Action=0 (0=Log,1=Dyn,2=Sta), TTL=0s, Path=
DEBUG: Count(1.2.3.4, 60) = 1
DEBUG: Count(1.2.3.4, 60) = 1
DEBUG: Count(1.2.3.4, 60) = 2
--- PASS: TestAliasFunctions (0.00s)
=== RUN   TestCloudflareStyle
Compiling Rule cf_style_complex: 
				Get("uri") contains "/admin" && 
				Get("ua") matches "(?i)curl" && 
				!(IP in ["10.0.0.1", "10.0.0.2"])
			
2026/02/11 15:06:51 ✅ Rule 'cf_style_complex' loaded: Action=1 (0=Log,1=Dyn,2=Sta), TTL=0s, Path=
Compiling Rule cf_style_lower: Lower(Get("ua")) contains "googlebot"
2026/02/11 15:06:51 ⚠️  Rule 'cf_style_lower': Unknown action 'allow', defaulting to Log (0).
2026/02/11 15:06:51 ✅ Rule 'cf_style_lower' loaded: Action=0 (0=Log,1=Dyn,2=Sta), TTL=0s, Path=
Compiling Rule cf_style_status: Int(Get("status")) >= 500
2026/02/11 15:06:51 ✅ Rule 'cf_style_status' loaded: Action=1 (0=Log,1=Dyn,2=Sta), TTL=0s, Path=
--- PASS: TestCloudflareStyle (0.00s)
=== RUN   TestCustomServiceRules
Compiling Rule nginx_403: len(Fields()) > 8 && Fields()[8] == "403"
2026/02/11 15:06:51 ✅ Rule 'nginx_403' loaded: Action=1 (0=Log,1=Dyn,2=Sta), TTL=0s, Path=
Compiling Rule custom_app_error: Get("service") == "payment" && Get("error_code") == "E500"
2026/02/11 15:06:51 ✅ Rule 'custom_app_error' loaded: Action=1 (0=Log,1=Dyn,2=Sta), TTL=0s, Path=
Compiling Rule quoted_value: Get("msg") == "Access Denied"
2026/02/11 15:06:51 ✅ Rule 'quoted_value' loaded: Action=1 (0=Log,1=Dyn,2=Sta), TTL=0s, Path=
--- PASS: TestCustomServiceRules (0.00s)
=== RUN   TestExpressionAliases
Compiling Rule use_log_alias: Contains(Log, "error")
2026/02/11 15:06:51 ✅ Rule 'use_log_alias' loaded: Action=1 (0=Log,1=Dyn,2=Sta), TTL=0s, Path=
Compiling Rule use_msg_alias: Msg("panic")
2026/02/11 15:06:51 ✅ Rule 'use_msg_alias' loaded: Action=1 (0=Log,1=Dyn,2=Sta), TTL=0s, Path=
Compiling Rule mixed_aliases: Contains(Log, "fatal") && Msg("database")
2026/02/11 15:06:51 ✅ Rule 'mixed_aliases' loaded: Action=1 (0=Log,1=Dyn,2=Sta), TTL=0s, Path=
    expr_alias_test.go:48: Expected use_log_alias, got false/
    expr_alias_test.go:62: Expected mixed_aliases, got false/
--- FAIL: TestExpressionAliases (0.00s)
=== RUN   TestFrequencyControl
Compiling Rule nginx_404_flood: ((Contains(Line, " 404 "))) && Count(10) > 5
2026/02/11 15:06:51 ✅ Rule 'nginx_404_flood' loaded: Action=1 (0=Log,1=Dyn,2=Sta), TTL=0s, Path=/var/log/nginx/access.log
Compiling Rule auth_bruteforce: ((Contains(Line, "Failed") || Contains(Line, "failure") || Contains(Line, "fail"))) && Count(60) > 3
2026/02/11 15:06:51 ✅ Rule 'auth_bruteforce' loaded: Action=1 (0=Log,1=Dyn,2=Sta), TTL=0s, Path=/var/log/auth.log
DEBUG: Count(192.168.1.50, 10) = 1
DEBUG: Count(192.168.1.50, 10) = 2
DEBUG: Count(192.168.1.50, 10) = 3
DEBUG: Count(192.168.1.50, 10) = 4
DEBUG: Count(192.168.1.50, 10) = 5
DEBUG: Count(192.168.1.50, 10) = 6
DEBUG: Count(10.10.10.10, 60) = 1
DEBUG: Count(10.10.10.10, 60) = 2
DEBUG: Count(10.10.10.10, 60) = 3
DEBUG: Count(10.10.10.10, 60) = 4
--- PASS: TestFrequencyControl (0.00s)
=== RUN   TestIrregularLogFormat
Compiling Rule auth_fail: Contains(Line, "Failed") && Count(60) > 3
2026/02/11 15:06:51 ✅ Rule 'auth_fail' loaded: Action=1 (0=Log,1=Dyn,2=Sta), TTL=0s, Path=
DEBUG: Count(10.0.0.1, 60) = 11
DEBUG: Count(10.0.0.1, 60) = 12
DEBUG: Count(10.0.0.1, 60) = 13
DEBUG: Count(10.0.0.1, 60) = 14
--- PASS: TestIrregularLogFormat (0.00s)
=== RUN   TestServiceIsolation
Compiling Rule ssh_bruteforce: Contains(Source, "auth.log") && Contains(Line, "Failed") && Count(60) > 3
2026/02/11 15:06:51 ✅ Rule 'ssh_bruteforce' loaded: Action=1 (0=Log,1=Dyn,2=Sta), TTL=0s, Path=
Compiling Rule nginx_flood: Contains(Source, "access.log") && Contains(Line, "404") && Count(60) > 5
2026/02/11 15:06:51 ✅ Rule 'nginx_flood' loaded: Action=1 (0=Log,1=Dyn,2=Sta), TTL=0s, Path=
DEBUG: Count(192.168.1.100, 60) = 1
DEBUG: Count(192.168.1.100, 60) = 2
DEBUG: Count(192.168.1.100, 60) = 3
DEBUG: Count(192.168.1.100, 60) = 4
DEBUG: Count(192.168.1.102, 60) = 1
DEBUG: Count(192.168.1.102, 60) = 2
DEBUG: Count(192.168.1.102, 60) = 3
DEBUG: Count(192.168.1.102, 60) = 4
DEBUG: Count(192.168.1.102, 60) = 5
DEBUG: Count(192.168.1.102, 60) = 6
--- PASS: TestServiceIsolation (0.00s)
=== RUN   TestIPExtractor
--- PASS: TestIPExtractor (0.00s)
=== RUN   TestCounter
--- PASS: TestCounter (0.00s)
=== RUN   TestRuleEngine
Compiling Rule rule1: Count(60) > 5
2026/02/11 15:06:51 ✅ Rule 'rule1' loaded: Action=1 (0=Log,1=Dyn,2=Sta), TTL=0s, Path=
DEBUG: Count(1.2.3.4, 60) = 1
DEBUG: Count(1.2.3.4, 60) = 6
--- PASS: TestRuleEngine (0.00s)
=== RUN   TestIPv6Support
Compiling Rule ipv6_test: Count(60) > 3
2026/02/11 15:06:51 ✅ Rule 'ipv6_test' loaded: Action=1 (0=Log,1=Dyn,2=Sta), TTL=0s, Path=
DEBUG: Count(2001:db8::1, 60) = 5
--- PASS: TestIPv6Support (0.00s)
=== RUN   TestLogicRules
Compiling Rule contains_wildcard: (Line matches "User .* failed" && Contains(Line, "ssh"))
2026/02/11 15:06:51 ✅ Rule 'contains_wildcard' loaded: Action=1 (0=Log,1=Dyn,2=Sta), TTL=0s, Path=
Compiling Rule any_contains: (Contains(Line, "sys_panic") || Contains(Line, "unknown_err"))
2026/02/11 15:06:51 ✅ Rule 'any_contains' loaded: Action=1 (0=Log,1=Dyn,2=Sta), TTL=0s, Path=
Compiling Rule not_contains: (Contains(Line, "crit_err")) && !Contains(Line, "test") && !Contains(Line, "debug")
2026/02/11 15:06:51 ✅ Rule 'not_contains' loaded: Action=1 (0=Log,1=Dyn,2=Sta), TTL=0s, Path=
Compiling Rule complex: (Contains(Line, "db_fatal")) && (Contains(Line, "timeout") || Contains(Line, "deadlock")) && !Contains(Line, "replica")
2026/02/11 15:06:51 ✅ Rule 'complex' loaded: Action=1 (0=Log,1=Dyn,2=Sta), TTL=0s, Path=
--- PASS: TestLogicRules (0.00s)
=== RUN   TestOptimizedLike
Compiling Rule wildcard_test: (Line matches "User .* failed")
2026/02/11 15:06:51 ✅ Rule 'wildcard_test' loaded: Action=1 (0=Log,1=Dyn,2=Sta), TTL=0s, Path=
Compiling Rule cidr_test: InCIDR("192.168.0.0/16")
2026/02/11 15:06:51 ⚠️  Rule 'cidr_test': Unknown action 'allow', defaulting to Log (0).
2026/02/11 15:06:51 ✅ Rule 'cidr_test' loaded: Action=0 (0=Log,1=Dyn,2=Sta), TTL=0s, Path=
--- PASS: TestOptimizedLike (0.00s)
=== RUN   TestPathMatching
Compiling Rule nginx_rule: true
2026/02/11 15:06:51 ✅ Rule 'nginx_rule' loaded: Action=1 (0=Log,1=Dyn,2=Sta), TTL=0s, Path=access.log
Compiling Rule var_log_rule: true
2026/02/11 15:06:51 ✅ Rule 'var_log_rule' loaded: Action=1 (0=Log,1=Dyn,2=Sta), TTL=0s, Path=/var/log/*.log
Compiling Rule exact_path: true
2026/02/11 15:06:51 ✅ Rule 'exact_path' loaded: Action=1 (0=Log,1=Dyn,2=Sta), TTL=0s, Path=/etc/hosts
Compiling Rule no_path: true
2026/02/11 15:06:51 ✅ Rule 'no_path' loaded: Action=1 (0=Log,1=Dyn,2=Sta), TTL=0s, Path=
--- PASS: TestPathMatching (0.00s)
=== RUN   TestRulePolicies
Compiling Rule block_non_root_immediate: Contains(Line, "Failed") && !Contains(Line, "root")
2026/02/11 15:06:51 ✅ Rule 'block_non_root_immediate' loaded: Action=1 (0=Log,1=Dyn,2=Sta), TTL=0s, Path=
Compiling Rule block_root_retry: Contains(Line, "Failed") && Contains(Line, "root") && Count(60) > 2
2026/02/11 15:06:51 ✅ Rule 'block_root_retry' loaded: Action=1 (0=Log,1=Dyn,2=Sta), TTL=0s, Path=
DEBUG: Count(2.2.2.2, 60) = 1
DEBUG: Count(2.2.2.2, 60) = 2
DEBUG: Count(2.2.2.2, 60) = 3
--- PASS: TestRulePolicies (0.00s)
=== RUN   TestRealWorldSSHLogs
    real_world_test.go:34: Line 1 extracted: [165.22.205.152]
    real_world_test.go:34: Line 2 extracted: [165.22.205.152]
    real_world_test.go:34: Line 3 extracted: [178.62.249.170]
    real_world_test.go:34: Line 4 extracted: [161.35.148.113]
    real_world_test.go:34: Line 5 extracted: []
    real_world_test.go:34: Line 6 extracted: [161.35.148.113]
    real_world_test.go:34: Line 7 extracted: [178.62.249.170]
    real_world_test.go:34: Line 8 extracted: [161.35.148.113]
    real_world_test.go:34: Line 9 extracted: [178.62.249.170]
    real_world_test.go:34: Line 10 extracted: [161.35.148.113]
    real_world_test.go:54: ✅ IP 165.22.205.152 found in 2 lines
    real_world_test.go:54: ✅ IP 178.62.249.170 found in 3 lines
    real_world_test.go:54: ✅ IP 161.35.148.113 found in 4 lines
--- PASS: TestRealWorldSSHLogs (0.00s)
=== RUN   TestSimplifiedRules
Compiling Rule simple_keyword: (Contains(Line, "Failed") && Contains(Line, "password"))
2026/02/11 15:06:51 ✅ Rule 'simple_keyword' loaded: Action=1 (0=Log,1=Dyn,2=Sta), TTL=0s, Path=
Compiling Rule rate_limit: ((Contains(Line, "Connection"))) && Count(10) > 2
2026/02/11 15:06:51 ✅ Rule 'rate_limit' loaded: Action=1 (0=Log,1=Dyn,2=Sta), TTL=0s, Path=
Compiling Rule regex_check: (Line matches "^User \\w+ login")
2026/02/11 15:06:51 ✅ Rule 'regex_check' loaded: Action=1 (0=Log,1=Dyn,2=Sta), TTL=0s, Path=
Compiling Rule combined: ((Contains(Line, "Error") && Line matches "[0-9]{3}")) && Count(60) > 1
2026/02/11 15:06:51 ✅ Rule 'combined' loaded: Action=1 (0=Log,1=Dyn,2=Sta), TTL=0s, Path=
DEBUG: Count(1.2.3.4, 10) = 1
DEBUG: Count(1.2.3.4, 10) = 2
DEBUG: Count(1.2.3.4, 10) = 3
DEBUG: Count(1.2.3.4, 60) = 4
DEBUG: Count(1.2.3.4, 60) = 5
--- PASS: TestSimplifiedRules (0.00s)
=== RUN   TestStandardizedLogic
Compiling Rule std_and_logic: (Contains(Line, "Error") && Contains(Line, "Database"))
2026/02/11 15:06:51 ✅ Rule 'std_and_logic' loaded: Action=1 (0=Log,1=Dyn,2=Sta), TTL=0s, Path=
Compiling Rule std_or_logic: (Contains(Line, "Timeout") || Contains(Line, "Deadlock"))
2026/02/11 15:06:51 ✅ Rule 'std_or_logic' loaded: Action=1 (0=Log,1=Dyn,2=Sta), TTL=0s, Path=
Compiling Rule std_not_logic: (Contains(Line, "Fatal")) && !Contains(Line, "Test")
2026/02/11 15:06:51 ✅ Rule 'std_not_logic' loaded: Action=1 (0=Log,1=Dyn,2=Sta), TTL=0s, Path=
--- PASS: TestStandardizedLogic (0.00s)
=== RUN   TestSimplifiedSyntax
Compiling Rule block_non_root_yaml: (Contains(Line, "Failed")) && !Contains(Line, "root")
2026/02/11 15:06:51 ✅ Rule 'block_non_root_yaml' loaded: Action=1 (0=Log,1=Dyn,2=Sta), TTL=0s, Path=
Compiling Rule block_root_match_yaml: (Contains(Line, "Failed") && Contains(Line, "root"))
2026/02/11 15:06:51 ✅ Rule 'block_root_match_yaml' loaded: Action=0 (0=Log,1=Dyn,2=Sta), TTL=0s, Path=
Compiling Rule or_logic_yaml: (Contains(Line, "Invalid user") || Contains(Line, "Failed password"))
2026/02/11 15:06:51 ✅ Rule 'or_logic_yaml' loaded: Action=1 (0=Log,1=Dyn,2=Sta), TTL=0s, Path=
--- PASS: TestSimplifiedSyntax (0.00s)
=== RUN   TestWhitelistUser
Compiling Rule block_non_aa: (Contains(Line, "password for")) && !Contains(Line, " aa ")
2026/02/11 15:06:51 ✅ Rule 'block_non_aa' loaded: Action=1 (0=Log,1=Dyn,2=Sta), TTL=0s, Path=/var/log/auth.log
--- PASS: TestWhitelistUser (0.00s)
FAIL
FAIL	github.com/livp123/netxfw/test/log-engine	0.014s
FAIL
